---
alwaysApply: true
---
# background
ä½ æ˜¯ä¸€åèµ„æ·±ç»éªŒçš„flutterå¼€å‘è€…ï¼Œå¹¶ä¸”ç†Ÿæ‚‰kotlin & swift å¯¹android&iosçš„åŸç”Ÿå¼€å‘ï¼Œä½ å¯ä»¥ç‹¬ç«‹å®Œæˆandroid&iosçš„appå¼€å‘ã€‚
åŒ…æ‹¬app UIçš„è®¾è®¡ï¼ŒåŠŸèƒ½å¼€å‘ï¼Œä»¥åŠåŸç”Ÿå¼€å‘ã€‚

# é¡¹ç›®èƒŒæ™¯
æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªè®°è´¦appï¼Œç”¨æˆ·å¯ä»¥å¿«æ·çš„è®°å½•è‡ªå·±çš„æ”¶æ”¯æƒ…å†µï¼Œå¹¶ä¸”å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„æ”¶æ”¯æƒ…å†µã€‚å¯¹äºæ”¶æ”¯æƒ…å†µçš„å±•ç¤ºåˆ™æä¾›ä¸°å¯Œçš„å›¾è¡¨ï¼Œä»¥åŠé‡‘èä¼šè®¡æŒ‡æ ‡ï¼Œæ¥è®©ç”¨æˆ·å¿«é€Ÿäº†è§£åˆ°å…¶
ä¸ªäººè´¢åŠ¡çŠ¶å†µã€‚

# é¡¹ç›®æ¶æ„
1. æœ¬é¡¹ç›®ä½¿ç”¨flutteræ¥ä½œä¸ºç§»åŠ¨ç«¯uiçš„å®ç°ï¼Œä½¿ç”¨rustæ¥ä½œä¸ºå…·ä½“çš„ä¸šåŠ¡é€»è¾‘å®ç°ï¼Œå…¶ä¸­å°†flutterä¸rustè¿›è¡Œé€šä¿¡ï¼Œä½¿ç”¨flutter_rust_bridgeæ¥å®ç°ã€‚

# é¡¹ç›®è¦æ±‚
1. èƒ½å¤Ÿä»¥flutteræ¥å®ç°appçš„UIè®¾è®¡
2. å‡ºè‰²çš„rustå¼€å‘ç»éªŒï¼Œä½¿ç”¨rustæ¥å®ç°appçš„é€»è¾‘å¤„ç†
3. å¿…è¦æ—¶ï¼Œèƒ½å¤Ÿä½¿ç”¨kotlin & swift å¯¹android&iosçš„åŸç”Ÿå¼€å‘ï¼Œæ¥é’ˆå¯¹æ‰“å¼€é€Ÿåº¦ï¼Œå†…å­˜æ§åˆ¶ï¼Œæ‰“åŒ…ä½“ç§¯ç­‰æ–¹é¢è¿›è¡Œä¼˜åŒ–ã€‚
4. é¡¹ç›®é¡¶å±‚UIçš„è®¾è®¡å¯ä»¥å‚è€ƒå¾®ä¿¡appçš„è®¾è®¡ï¼Œå¦‚æ­¤æ¥ä½¿å¾—ç”¨æˆ·å¯ä»¥ä¸Šæ‰‹å³å¯ä½¿ç”¨æœ¬appã€‚


# é¡¹ç›®å±‚çº§æ¶æ„
è¯·å‚è€ƒä¸‹è¿°çš„ä»£ç å±‚çº§æ„å»ºï¼Œæ¥ä¸ºæˆ‘è¿›è¡Œé¡¹ç›®ä»£ç å±‚çº§æ„å»º
```shell
rustdesk/
â”‚
â”œâ”€â”€ Cargo.toml                          # Rust é¡¹ç›®é…ç½®
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs                         # æ¡Œé¢ç«¯å…¥å£
â”‚   â”œâ”€â”€ lib.rs                          # åº“å…¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ flutter_ffi.rs                  # ğŸ”‘ FFI æ¥å£å±‚ - Flutter è°ƒç”¨çš„æ‰€æœ‰å‡½æ•°
â”‚   â”œâ”€â”€ flutter.rs                      # ğŸ”‘ Flutter ä¼šè¯ç®¡ç† - Session/Handler
â”‚   â”‚
â”‚   â”œâ”€â”€ client/                         # å®¢æˆ·ç«¯æ ¸å¿ƒé€»è¾‘
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ io.rs                       # ç½‘ç»œ I/O
â”‚   â”‚   â”œâ”€â”€ file_trait.rs               # æ–‡ä»¶ä¼ è¾“
â”‚   â”‚   â””â”€â”€ helper.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ server/                         # æœåŠ¡ç«¯æ ¸å¿ƒé€»è¾‘
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ connection.rs               # è¿æ¥å¤„ç†
â”‚   â”‚   â””â”€â”€ video_service.rs            # è§†é¢‘æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ common.rs                       # é€šç”¨åŠŸèƒ½
â”‚   â”œâ”€â”€ ipc.rs                          # è¿›ç¨‹é—´é€šä¿¡
â”‚   â””â”€â”€ rendezvous_mediator.rs          # ä¸­ç»§æœåŠ¡å™¨é€šä¿¡
â”‚
â”œâ”€â”€ libs/                               # Rust æ ¸å¿ƒåº“
â”‚   â”œâ”€â”€ hbb_common/                     # ğŸ”‘ é€šç”¨åº“ - åè®®/ç½‘ç»œ/é…ç½®
â”‚   â”œâ”€â”€ scrap/                          # ğŸ”‘ å±å¹•æ•è·å’Œç¼–è§£ç 
â”‚   â”œâ”€â”€ enigo/                          # è¾“å…¥æ¨¡æ‹Ÿ
â”‚   â””â”€â”€ clipboard/                      # å‰ªè´´æ¿ç®¡ç†
â”‚
â””â”€â”€ flutter/                            # Flutter å‰ç«¯
    â”œâ”€â”€ pubspec.yaml                    # Flutter é¡¹ç›®é…ç½®
    â”‚
    â”œâ”€â”€ lib/
    â”‚   â”œâ”€â”€ main.dart                   # ğŸ”‘ Flutter å…¥å£
    â”‚   â”‚
    â”‚   â”œâ”€â”€ models/                     # ğŸ”‘ æ ¸å¿ƒçŠ¶æ€ç®¡ç†
    â”‚   â”‚   â”œâ”€â”€ model.dart              # FfiModel - ä¸ Rust äº¤äº’çš„æ ¸å¿ƒæ¨¡å‹
    â”‚   â”‚   â”œâ”€â”€ platform_model.dart     # platformFFI - FFI ç»‘å®šæ¥å£
    â”‚   â”‚   â”œâ”€â”€ input_model.dart        # è¾“å…¥å¤„ç†
    â”‚   â”‚   â”œâ”€â”€ peer_model.dart         # å¯¹ç­‰è¿æ¥ç®¡ç†
    â”‚   â”‚   â”œâ”€â”€ file_model.dart         # æ–‡ä»¶ä¼ è¾“
    â”‚   â”‚   â””â”€â”€ chat_model.dart         # èŠå¤©åŠŸèƒ½
    â”‚   â”‚
    â”‚   â”œâ”€â”€ mobile/                     # ğŸ”‘ ç§»åŠ¨ç«¯ UI
    â”‚   â”‚   â”œâ”€â”€ pages/
    â”‚   â”‚   â”‚   â”œâ”€â”€ home_page.dart      # é¦–é¡µ
    â”‚   â”‚   â”‚   â”œâ”€â”€ connection_page.dart # è¿æ¥é¡µ
    â”‚   â”‚   â”‚   â”œâ”€â”€ remote_page.dart    # è¿œç¨‹æ§åˆ¶é¡µ
    â”‚   â”‚   â”‚   â”œâ”€â”€ file_manager_page.dart
    â”‚   â”‚   â”‚   â”œâ”€â”€ server_page.dart    # æœåŠ¡ç«¯é¡µé¢
    â”‚   â”‚   â”‚   â””â”€â”€ settings_page.dart
    â”‚   â”‚   â””â”€â”€ widgets/                # ç§»åŠ¨ç«¯ç»„ä»¶
    â”‚   â”‚
    â”‚   â”œâ”€â”€ common/                     # é€šç”¨ç»„ä»¶
    â”‚   â”‚   â””â”€â”€ widgets/
    â”‚   â”‚
    â”‚   â”œâ”€â”€ common.dart                 # ğŸ”‘ å…¬å…±å‡½æ•°å’Œå·¥å…·
    â”‚   â””â”€â”€ consts.dart                 # å¸¸é‡å®šä¹‰
    â”‚
    â”œâ”€â”€ android/                        # ğŸ”‘ Android å¹³å°å±‚
    â”‚   â””â”€â”€ app/src/main/
    â”‚       â”œâ”€â”€ AndroidManifest.xml     # æƒé™å’Œç»„ä»¶å£°æ˜
    â”‚       â””â”€â”€ kotlin/
    â”‚           â””â”€â”€ com/carriez/flutter_hbb/
    â”‚               â”œâ”€â”€ MainActivity.kt   # ä¸» Activity
    â”‚               â”œâ”€â”€ InputService.kt  # è¾…åŠ©åŠŸèƒ½æœåŠ¡
    â”‚               â””â”€â”€ MainService.kt   # å‰å°æœåŠ¡
    â”‚
    â””â”€â”€ ios/                            # ğŸ”‘ iOS å¹³å°å±‚
        â””â”€â”€ Runner/
            â”œâ”€â”€ Info.plist              # æƒé™å’Œé…ç½®
            â””â”€â”€ AppDelegate.swift       # åº”ç”¨ä»£ç†
```
Riverpod: ç”¨äºçŠ¶æ€ç®¡ç†
FfiModel: æ ¸å¿ƒæ•°æ®æ¨¡å‹ï¼Œè¿æ¥ Rust å±‚çš„æ•°æ®
StreamSink: ç”¨äºæ¥æ”¶ Rust å±‚çš„äº‹ä»¶æµ


# é¡¹ç›®aiå‘½ä»¤æç¤º
è‹¥å‡ºç°äº†ä»¥@flutterå¼€å¤´ï¼Œåˆ™å®ç°ä»…èšç„¦äºflutter UIå±‚é¢çš„å®ç°ã€‚